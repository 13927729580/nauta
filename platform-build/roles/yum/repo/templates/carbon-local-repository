Summary: Carbon user package
Name: carbon-yum-local
Version: 0.1.0
Release: {{ build_id }}
License: Apache-2.0
Group: Tools

BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root

Requires: carbon-yum-repository = %{version}-%{release}

%define  debug_package %{nil}

%description
%{summary}

%prep
# Empty section

%build
# Empty section.

%install
rm -rf %{buildroot}
mkdir -p  %{buildroot}

mkdir -p %{buildroot}/opt/carbon/yum/yum.repos.d
mkdir -p %{buildroot}%{_bindir}

echo "[main]
cachedir=/var/cache/yum-carbon/$basearch/$releasever
keepcache=0
debuglevel=2
logfile=/var/log/yum.log
exactarch=1
obsoletes=1
gpgcheck=0
plugins=0
installonly_limit=5
distroverpkg=centos-release
reposdir=/opt/carbon/yum/yum.repos.d
proxy=_none_" > %{buildroot}/opt/carbon/yum/yum.conf

echo "[CarbonLocal]
name=Carbon Local Repository
gpgcheck=0
enabled=1
baseurl=file:///opt/carbon/repository" > %{buildroot}/opt/carbon/yum/yum.repos.d/local.repo

echo '#!/usr/bin/env bash
set -e
yum -c /opt/carbon/yum/yum.conf $@' > %{buildroot}%{_bindir}/yum-carbon
chmod +x %{buildroot}%{_bindir}/yum-carbon

%clean
# Empty

%files
%defattr(-,root,root,-)
%{_bindir}/yum-carbon
/opt/carbon/yum/yum.conf
/opt/carbon/yum/yum.repos.d/local.repo
