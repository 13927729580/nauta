---

- set_fact:
    base_image: {}

- name: Calculate base image
  vars:
    image_to_add: "127.0.0.1:{{ registry_port }}/{{ item.value }}:{{ images[item.value].version }}"
  set_fact:
    base_image: "{{ base_image | combine({item.key: image_to_add}) }}"
  with_dict: "{{ image.required }}"

- name: Add image definition
  set_fact:
    docker_images_base: "{{ docker_images_base | combine({ name: base_image }) }}"

- name: Ensure directory exists
  file:
    path: "{{ image.directory }}"
